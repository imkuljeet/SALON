<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Dashboard</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./css/adminDashboard.css">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
    <div class="container">
      <a class="navbar-brand" href="index.html">Salon Admin</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
              aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <button class="btn btn-danger" onclick="logout()">Logout</button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Admin Dashboard Sections -->
  <section class="container py-5">
    <h1 class="text-center mb-4">Admin Dashboard</h1>
    <!-- Total Appointments Overview -->
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">Total Booked</h5>
            <p class="card-text">120</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">Completed</h5>
            <p class="card-text">90</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">Canceled</h5>
            <p class="card-text">30</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Manage Appointments -->
    <div class="mb-5">
      <h3>Manage Appointments</h3>
      <button class="btn btn-primary mb-3">View & Update</button>
      <!-- Appointments Table -->
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>#</th>
              <th>Customer Name</th>
              <th>Service</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>John Doe</td>
              <td>Haircut</td>
              <td>Booked</td>
              <td><button class="btn btn-sm btn-success">Complete</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Manage Customers -->
    <div class="mb-5">
      <h3>Manage Customers</h3>
      <button class="btn btn-primary mb-3">View Customers</button>
    </div>

    <!-- Manage Services -->
    <div class="mb-5">
      <h3>Manage Services</h3>
      
      <!-- Add Service Button -->
      <button class="btn btn-primary mb-3" id="addServiceButton">Add Service</button> <!-- Button to open form -->

      <!-- Service Form Container (hidden initially) -->
      <div id="serviceFormContainer" class="mt-4"></div> <!-- Container for dynamic service form -->

      <!-- Services Table Container -->
      <div id="servicesTableContainer" class="table-responsive mt-4"></div> <!-- Container for dynamic table -->
    </div>

      <!-- Staff Management -->
  <div class="mb-5">
    <h3>Staff Management</h3>
    <button class="btn btn-primary mb-3" id="addStaffButton">Add Staff</button> <!-- Add Staff button stays as before -->
    <div id="staffFormContainer" class="mt-4"></div> <!-- Form container -->
    <div id="staffListContainer" class="table-responsive"></div> <!-- Staff table container -->
  </div>


  </section>

  <!-- Footer -->
  <footer class="py-4 bg-dark text-light text-center">
    <div class="container">
      <p class="mb-0">&copy; 2025 Salon Admin Dashboard. All Rights Reserved.</p>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.8.4/axios.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
  const staffListContainer = document.getElementById('staffListContainer');
  const staffFormContainer = document.getElementById('staffFormContainer');
  const servicesTableContainer = document.getElementById('servicesTableContainer');
  const serviceFormContainer = document.getElementById('serviceFormContainer');

  /* ---------------- STAFF MANAGEMENT ---------------- */

  // Fetch and display staff details
  const fetchStaffDetails = () => {
    axios.get('http://localhost:3000/staff/get-staffs')
      .then(response => {
        const staffData = response.data.staff;
        if (staffData.length === 0) {
          // If no staff data, hide the table
          staffListContainer.style.display = 'none';
        } else {
          staffListContainer.style.display = 'block';
          staffListContainer.innerHTML = '';
          const table = document.createElement('table');
          table.classList.add('table', 'table-bordered');
          const thead = document.createElement('thead');
          const headerRow = document.createElement('tr');
          ['#', 'Name', 'Email', 'Position', 'Status', 'Actions'].forEach(headerText => {
            const th = document.createElement('th');
            th.innerText = headerText;
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);
          const tbody = document.createElement('tbody');
          staffData.forEach((member, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${index + 1}</td>
              <td>${member.name}</td>
              <td>${member.email}</td>
              <td>${member.position}</td>
              <td>${member.status}</td>
              <td>
                <button class="btn btn-sm btn-primary">Edit</button>
                <button class="btn btn-sm btn-danger ms-2">Delete</button>
              </td>
            `;
            tbody.appendChild(row);
          });
          table.appendChild(thead);
          table.appendChild(tbody);
          staffListContainer.appendChild(table);
        }
      })
      .catch(error => {
        console.error('Error fetching staff details:', error);
        staffListContainer.style.display = 'none'; // Hide table in case of an error
      });
  };

  // Handle "Add Staff" button click
  document.getElementById('addStaffButton').addEventListener('click', () => {
    staffFormContainer.innerHTML = '';
    const form = document.createElement('form');
    form.classList.add('p-4', 'border', 'bg-light', 'rounded');
    form.innerHTML = `
      <div class="mb-3">
        <label for="staffName" class="form-label">Name</label>
        <input type="text" id="staffName" class="form-control" placeholder="Enter staff name">
      </div>
      <div class="mb-3">
        <label for="staffEmail" class="form-label">Email</label>
        <input type="email" id="staffEmail" class="form-control" placeholder="Enter staff email">
      </div>
      <div class="mb-3">
        <label for="staffPosition" class="form-label">Position</label>
        <select id="staffPosition" class="form-select">
          <option value="Stylist">Stylist</option>
          <option value="Manager">Manager</option>
          <option value="Receptionist">Receptionist</option>
          <option value="Assistant">Assistant</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="staffStatus" class="form-label">Status</label>
        <select id="staffStatus" class="form-select">
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
        </select>
      </div>
      <button type="submit" class="btn btn-success">Save Staff</button>
    `;
    form.addEventListener('submit', event => {
      event.preventDefault();
      const payload = {
        name: document.getElementById('staffName').value,
        email: document.getElementById('staffEmail').value,
        position: document.getElementById('staffPosition').value,
        status: document.getElementById('staffStatus').value,
      };
      axios.post('http://localhost:3000/staff/add-staff', payload)
        .then(() => {
          alert('Staff added successfully!');
          staffFormContainer.innerHTML = '';
          fetchStaffDetails();
        })
        .catch(error => console.error('Error adding staff:', error));
    });
    staffFormContainer.appendChild(form);
  });

  fetchStaffDetails();

  /* ---------------- SERVICES MANAGEMENT ---------------- */

  // Fetch and display services
  const fetchServices = () => {
    axios.get('http://localhost:3000/service/get-services')
      .then(response => {
        const services = response.data.services;
        if (services.length === 0) {
          // If no services data, hide the table
          servicesTableContainer.style.display = 'none';
        } else {
          servicesTableContainer.style.display = 'block';
          servicesTableContainer.innerHTML = '';
          const table = document.createElement('table');
          table.classList.add('table', 'table-bordered');
          const thead = document.createElement('thead');
          const headerRow = document.createElement('tr');
          ['#', 'Name', 'Price', 'Duration', 'Actions'].forEach(headerText => {
            const th = document.createElement('th');
            th.innerText = headerText;
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);
          const tbody = document.createElement('tbody');
          services.forEach((service, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${index + 1}</td>
              <td>${service.name}</td>
              <td>₹${service.price}</td>
              <td>${service.duration} mins</td>
              <td>
                <button class="btn btn-sm btn-primary">Edit</button>
                <button class="btn btn-sm btn-danger ms-2">Delete</button>
              </td>
            `;
            tbody.appendChild(row);
          });
          table.appendChild(thead);
          table.appendChild(tbody);
          servicesTableContainer.appendChild(table);
        }
      })
      .catch(error => {
        console.error('Error fetching services:', error);
        servicesTableContainer.style.display = 'none'; // Hide table in case of an error
      });
  };

  // Handle "Add Service" button click
  document.getElementById('addServiceButton').addEventListener('click', () => {
    serviceFormContainer.innerHTML = '';
    const form = document.createElement('form');
    form.classList.add('p-4', 'border', 'bg-light', 'rounded');
    form.innerHTML = `
      <div class="mb-3">
        <label for="serviceName" class="form-label">Service Name</label>
        <input type="text" id="serviceName" class="form-control" placeholder="Enter service name">
      </div>
      <div class="mb-3">
        <label for="servicePrice" class="form-label">Price (₹)</label>
        <input type="number" id="servicePrice" class="form-control" placeholder="Enter service price">
      </div>
      <div class="mb-3">
        <label for="serviceDuration" class="form-label">Duration (mins)</label>
        <input type="number" id="serviceDuration" class="form-control" placeholder="Enter service duration">
      </div>
      <button type="submit" class="btn btn-success">Save Service</button>
    `;
    form.addEventListener('submit', (event) => {
      event.preventDefault();
      const payload = {
        name: document.getElementById('serviceName').value,
        price: document.getElementById('servicePrice').value,
        duration: document.getElementById('serviceDuration').value,
      };
      axios.post('http://localhost:3000/service/add-service', payload)
        .then(() => {
          alert('Service added successfully!');
          serviceFormContainer.innerHTML = '';
          fetchServices();
        })
        .catch(error => console.error('Error adding service:', error));
    });
    serviceFormContainer.appendChild(form);
  });

  fetchServices();
});

  </script>

</body>
</html>
